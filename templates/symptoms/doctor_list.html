{% extends 'base.html' %}
{% block title %}Symptômes de mes patients{% endblock %}
{% block content %}
  <h1>Symptômes de mes patients</h1>

  <p><a class="btn" href="{% url 'symptoms_html:export_doctor_symptoms_csv' %}">Exporter en CSV</a></p>

  <form method="get" style="margin-bottom:1rem">
    <input type="text" name="q" value="{{ q }}" placeholder="Rechercher patient ou texte…">
    <select name="severity">
      <option value="">Toutes sévérités</option>
      <option value="mild" {% if severity == 'mild' %}selected{% endif %}>Léger</option>
      <option value="moderate" {% if severity == 'moderate' %}selected{% endif %}>Modéré</option>
      <option value="severe" {% if severity == 'severe' %}selected{% endif %}>Sévère</option>
    </select>
    <button type="submit">Filtrer</button>
  </form>

  {% if items %}
    <table class="table">
      <thead>
        <tr><th>Date</th><th>Patient</th><th>Sévérité</th><th>Description</th></tr>
      </thead>
      <tbody>
        {% for s in items %}
          <tr>
            <td>{{ s.created_at|date:"d/m/Y H:i" }}</td>
            <td>{{ s.patient.user.get_full_name|default:s.patient.user.username }}</td>
            <td><span class="badge {{ s.severity|default:'mild' }}">{{ s.get_severity_display|default:"—" }}</span></td>
            <td>{{ s.description|linebreaksbr }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="card">Aucun symptôme déclaré.</div>
  {% endif %}
{% if page.object_list %}
  <table class="table">
    <thead>
      <tr><th>Date</th><th>Sévérité</th><th>Description</th><th>Actions</th></tr>
    </thead>
    <tbody>
      {% for s in page.object_list %}
        <tr>
          <td>{{ s.created_at|date:"d/m/Y H:i" }}</td>
          <td><span class="badge {{ s.severity|default:'mild' }}">{{ s.get_severity_display|default:"—" }}</span></td>
          <td>{{ s.description|linebreaksbr }}</td>
          <td>
            <a class="btn" href="{% url 'symptoms_html:edit_symptom' s.id %}">Modifier</a>
            <a class="btn danger" href="{% url 'symptoms_html:delete_symptom' s.id %}">Supprimer</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if page.paginator.num_pages > 1 %}
    <p>
      {% if page.has_previous %}
        <a class="btn" href="?page={{ page.previous_page_number }}&q={{ q }}&severity={{ severity }}">←</a>
      {% endif %}
      Page {{ page.number }}/{{ page.paginator.num_pages }}
      {% if page.has_next %}
        <a class="btn" href="?page={{ page.next_page_number }}&q={{ q }}&severity={{ severity }}">→</a>
      {% endif %}
    </p>
      {% endif %}
    {% else %}
        <div class="card">Aucun symptôme enregistré.</div>
    {% endif %}
{% endblock %}
